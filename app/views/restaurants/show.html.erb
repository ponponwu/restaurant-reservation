<div class="min-h-screen bg-gray-900 text-white">
  <!-- Flash è¨Šæ¯é¡¯ç¤º -->
  <% if notice || alert %>
    <div class="fixed top-4 right-4 z-50">
      <%= render 'shared/flash' %>
    </div>
  <% end %>

  <!-- ä¸»è¦å…§å®¹ -->
  <div class="w-full max-w-md mx-auto bg-gray-900 min-h-screen md:max-w-lg lg:max-w-xl"
       data-controller="reservation restaurant-info"
       data-reservation-restaurant-slug-value="<%= @restaurant.slug %>">
    
    <!-- é¤å»³æ¨™é¡Œå€åŸŸ -->
    <div class="flex items-center justify-between p-4 border-b border-gray-700 bg-gray-800">
      <div class="flex items-center space-x-3">
        <!-- é¤å»³ Logo/åœ–ç¤º -->
        <div class="w-12 h-12 bg-gray-600 rounded-lg flex items-center justify-center">
          <svg class="w-6 h-6 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
        </div>
        <div>
          <h1 class="text-lg font-bold text-white"><%= @restaurant.name %></h1>
          <p class="text-sm text-gray-400">ç·šä¸Šè¨‚ä½</p>
        </div>
      </div>
      
      <!-- Info Icon -->
      <button data-restaurant-info-target="infoButton" 
              data-action="click->restaurant-info#toggleInfo"
              class="w-10 h-10 bg-gray-600 rounded-full flex items-center justify-center hover:bg-gray-500 transition-colors">
        <svg class="w-5 h-5 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
      </button>
    </div>

    <!-- é¤å»³è³‡è¨Šå½ˆå‡ºå±¤ -->
    <div data-restaurant-info-target="infoPanel" 
         class="hidden bg-gray-800 border-b border-gray-700">
      <div class="p-4 space-y-4">
        <!-- é›»è©± -->
        <div>
          <h3 class="text-sm font-medium text-gray-300 mb-1">é›»è©±</h3>
          <p class="text-white"><%= @restaurant.phone.present? ? @restaurant.phone : 'ç¶²' %></p>
        </div>
        
        <!-- åœ°å€ -->
        <div>
          <h3 class="text-sm font-medium text-gray-300 mb-1">åœ°å€</h3>
          <p class="text-white text-sm"><%= @restaurant.address.present? ? @restaurant.address : 'å°å—å¸‚ä¸­è¥¿å€è¥¿é–€è·¯äºŒæ®µ372å··23è™Ÿ' %></p>
        </div>
        
        <!-- ç‡Ÿæ¥­æ™‚é–“ -->
        <div>
          <h3 class="text-sm font-medium text-gray-300 mb-2">ç‡Ÿæ¥­æ™‚é–“</h3>
          <div class="space-y-1 text-sm">
            <% 
              day_names = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­']
            %>
            <% @restaurant.formatted_business_hours.each do |day_info| %>
              <div class="flex justify-between">
                <span class="text-gray-400"><%= day_names[day_info[:day_of_week]] %></span>
                <% if day_info[:is_closed] %>
                  <span class="text-gray-500">æœªç‡Ÿæ¥­</span>
                <% elsif day_info[:periods].any? %>
                  <div class="text-right">
                    <% day_info[:periods].each_with_index do |period, index| %>
                      <div class="text-white">
                        <%= period[:start_time] %>-<%= period[:end_time] %>
                      </div>
                    <% end %>
                  </div>
                <% else %>
                  <span class="text-gray-500">æœªç‡Ÿæ¥­</span>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
        
        <!-- æé†’äº‹é … -->
        <div>
          <h3 class="text-sm font-medium text-gray-300 mb-2">æé†’äº‹é …</h3>
          <div class="space-y-1 text-sm text-gray-400">
            <p>ğŸš« é–‹æ”¾27æ—¥å…§çš„æ—¥å­ï¼Œæ—¥ä¸€å…¬ä¼‘</p>
            <p>ğŸš« åŒ…å ´éœ€ä¾†è©¢å•IGç§è¨Šï¼Œ</p>
            <p>ğŸš« åº—å…§æä¾›å¤šç¨®è‡ªç„¶é…’æ­é…é¤é»ï¼Œæ•ä¸æ¥å—è‡ªå¸¶é…’æ°´ã€‚</p>
          </div>
        </div>
        
        <!-- ç‡Ÿæ¥­äººåç¨± -->
        <div class="pt-2 border-t border-gray-700">
          <p class="text-xs text-gray-500">ç‡Ÿæ¥­äººåç¨±ï¼š(å‡æ—¥æœ‰é™å…¬å¸)</p>
          <p class="text-xs text-gray-500">çµ±ä¸€ç·¨è™Ÿï¼š97603386</p>
        </div>
      </div>
    </div>

    <form action="<%= new_restaurant_reservation_path(@restaurant.slug) %>" method="get" id="reservation-form" class="bg-gray-900">
      <!-- éš±è—æ¬„ä½ç”¨æ–¼å­˜å„²é è¨‚è³‡è¨Š -->
      <input type="hidden" name="date" id="reservation_date">
      <input type="hidden" name="time" id="reservation_time">
      <input type="hidden" name="period_id" id="operating_period_id">
      <input type="hidden" name="adults" id="adult_count">
      <input type="hidden" name="children" id="child_count">
      
      <!-- ç”¨é¤äººæ•¸é¸æ“‡ -->
      <div class="p-4 border-b border-gray-700 bg-gray-900">
        <h2 class="text-lg font-semibold text-white mb-3">ç”¨é¤äººæ•¸</h2>
        <p class="text-sm text-gray-400 mb-4">å¯é ç´„ 1 - 6 ä½ï¼ˆå«å¤§äººèˆ‡å°å­©ï¼‰</p>
        
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">å¤§äºº</label>
            <select name="reservation[adult_count]" 
                    data-reservation-target="adultCount"
                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-3 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
              <% (@min_party_size..@display_max_party_size).each do |i| %>
                <option value="<%= i %>" <%= 'selected' if i == 2 %>><%= i %></option>
              <% end %>
            </select>
          </div>
          
          <div>
            <label class="block text-sm font-medium text-gray-300 mb-2">å°å­©</label>
            <select name="reservation[child_count]" 
                    data-reservation-target="childCount"
                    class="w-full bg-gray-800 border border-gray-600 rounded-lg px-3 py-3 text-white focus:border-blue-500 focus:ring-1 focus:ring-blue-500">
              <% (0..[@display_max_party_size - 1, 0].max).each do |i| %>
                <option value="<%= i %>"><%= i %></option>
              <% end %>
            </select>
          </div>
        </div>
      </div>

      <!-- æ—¥æœŸé¸æ“‡ -->
      <div class="bg-gray-900 py-6 flex justify-center">
        <!-- éš±è—çš„è¼¸å…¥æ¬„ä½ç”¨æ–¼å­˜å„²é¸æ“‡çš„æ—¥æœŸ -->
        <input type="hidden" 
               name="reservation[reservation_date]"
               data-reservation-target="date"
               id="selected_date">
        
        <!-- æ—¥æ›†å®¹å™¨ - ç½®ä¸­ä¸”è®Šå¤§ -->
        <div class="w-full max-w-lg px-4">
          <div data-reservation-target="calendar">
            <!-- flatpickr æ—¥æ›†æœƒç›´æ¥æ¸²æŸ“åœ¨é€™è£¡ -->
          </div>
        </div>
      </div>

      <!-- æ™‚é–“é¸æ“‡å€åŸŸ -->
      <div class="p-4 bg-gray-900">
        <!-- é¤æœŸè³‡è¨Š -->
        <div data-reservation-target="periodInfo" class="text-gray-400 mb-4">
          <p class="text-gray-500">è«‹å…ˆé¸æ“‡æ—¥æœŸä»¥æŸ¥çœ‹å¯ç”¨æ™‚é–“</p>
        </div>
        
        <!-- æ™‚é–“æ§½å®¹å™¨ -->
        <div data-reservation-target="timeSlots" class="space-y-4">
          <!-- æ™‚é–“é¸é …æœƒå‹•æ…‹è¼‰å…¥åˆ°é€™è£¡ -->
        </div>
      </div>

      <!-- ä¸‹ä¸€æ­¥æŒ‰éˆ• -->
      <div class="p-4 border-t border-gray-700 bg-gray-900">
        <button type="submit" 
                data-reservation-target="nextStep"
                class="w-full bg-gray-600 text-white py-4 rounded-lg font-medium disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-500 transition-colors text-lg"
                disabled>
          ä¸‹ä¸€æ­¥
        </button>
      </div>
    </form>
  </div>
</div>

<% content_for :stylesheets do %>
  <style>
    /* ç¢ºä¿æ•´å€‹é é¢éƒ½æ˜¯æ·±è‰²èƒŒæ™¯ */
    body {
      background-color: #111827 !important;
      color: #ffffff !important;
    }
    
    /* æ‰‹æ©Ÿå„ªå…ˆçš„éŸ¿æ‡‰å¼è¨­è¨ˆ */
    @media (max-width: 768px) {
      .w-full {
        width: 100% !important;
      }
    }
    
    /* æ»‘å‹•å‹•ç•« */
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-slideDown {
      animation: slideDown 0.3s ease-out;
    }
    
    /* ç¢ºä¿æ—¥æ›†å æ»¿å®¹å™¨ä¸”ç½®ä¸­ */
    .flatpickr-calendar.inline {
      position: relative !important;
      top: auto !important;
      left: auto !important;
      display: block !important;
      margin: 0 auto !important;
      width: 100% !important;
      max-width: 400px !important;
      background: #1f2937 !important;
      border-radius: 0.75rem !important;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3) !important;
      padding: 1rem !important;
    }
    
    /* å¼·åˆ¶æ—¥æ›†å®¹å™¨ç½®ä¸­ */
    [data-reservation-target="calendar"] {
      display: flex !important;
      justify-content: center !important;
      align-items: center !important;
    }
    
    /* ç¢ºä¿æ—¥æ›†åœ¨å®¹å™¨å…§ç½®ä¸­ */
    [data-reservation-target="calendar"] .flatpickr-calendar {
      margin-left: auto !important;
      margin-right: auto !important;
    }
    
    /* ç¢ºä¿æ—¥æœŸå®¹å™¨å æ»¿å¯¬åº¦ */
    .dayContainer {
      width: 100% !important;
      min-width: 100% !important;
      max-width: 100% !important;
    }
    
    .flatpickr-days {
      width: 100% !important;
    }
    
    .flatpickr-innerContainer {
      width: 100% !important;
    }
    
    .flatpickr-rContainer {
      width: 100% !important;
    }
    
    /* Dark ä¸»é¡Œå¯è¦‹åº¦æ”¹å–„ */
    .flatpickr-day {
      color: #e2e8f0 !important;
      background: transparent !important;
    }
    
    .flatpickr-day:hover:not(.flatpickr-disabled):not(.selected) {
      background: #4a5568 !important;
      color: #ffffff !important;
    }
    
    .flatpickr-day.today:not(.flatpickr-disabled) {
      background: #3182ce !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      border: 2px solid #63b3ed !important;
    }
    
    .flatpickr-day.selected {
      background: #2d3748 !important;
      color: #ffffff !important;
      font-weight: 700 !important;
      border: 2px solid #4299e1 !important;
    }
    
    .flatpickr-day.flatpickr-disabled {
      color: #718096 !important;
      background: #2d3748 !important;
      opacity: 0.5 !important;
    }
    
    .flatpickr-day.prevMonthDay,
    .flatpickr-day.nextMonthDay {
      color: #718096 !important;
      opacity: 0.6 !important;
    }
    
    /* æœˆä»½å°èˆªæ”¹å–„ */
    .flatpickr-current-month {
      color: #e2e8f0 !important;
    }
    
    .flatpickr-prev-month,
    .flatpickr-next-month {
      color: #e2e8f0 !important;
      fill: #e2e8f0 !important;
    }
    
    .flatpickr-prev-month:hover,
    .flatpickr-next-month:hover {
      color: #ffffff !important;
      fill: #ffffff !important;
    }
    
    /* æ˜ŸæœŸæ¨™é¡Œæ”¹å–„ */
    .flatpickr-weekday {
      color: #a0aec0 !important;
    }
    
    /* éŸ¿æ‡‰å¼èª¿æ•´ */
    @media (max-width: 640px) {
      .flatpickr-calendar.inline {
        width: 100% !important;
      }
    }
  </style>
<% end %> 
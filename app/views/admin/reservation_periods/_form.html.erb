<%= form_with model: [reservation_period.restaurant, reservation_period], 
    url: reservation_period.persisted? ? admin_restaurant_reservation_period_path(reservation_period.restaurant, reservation_period) : admin_restaurant_reservation_periods_path(reservation_period.restaurant),
    local: false,
    class: "space-y-6" do |form| %>
  
  <!-- 時段名稱 -->
  <div>
    <%= form.label :name, "時段名稱", class: "block text-sm font-medium text-gray-700" %>
    <span class="text-red-500 text-sm">*</span>
    <%= form.text_field :name,
        class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm #{'border-red-300' if reservation_period.errors[:name].any?}",
        placeholder: "例如：午餐、晚餐、下午茶",
        required: true %>
    <% if reservation_period.errors[:name].any? %>
      <p class="mt-1 text-sm text-red-600"><%= reservation_period.errors[:name].first %></p>
    <% end %>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <!-- 開始時間 -->
    <div>
      <%= form.label :start_time, "開始時間", class: "block text-sm font-medium text-gray-700" %>
      <span class="text-red-500 text-sm">*</span>
      <%= form.time_field :start_time,
          value: reservation_period.start_time&.strftime('%H:%M'),
          class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm #{'border-red-300' if reservation_period.errors[:start_time].any?}",
          required: true %>
      <p class="mt-1 text-sm text-gray-500">使用台北時間 (UTC+8)</p>
      <% if reservation_period.errors[:start_time].any? %>
        <p class="mt-1 text-sm text-red-600"><%= reservation_period.errors[:start_time].first %></p>
      <% end %>
    </div>

    <!-- 結束時間 -->
    <div>
      <%= form.label :end_time, "結束時間", class: "block text-sm font-medium text-gray-700" %>
      <span class="text-red-500 text-sm">*</span>
      <%= form.time_field :end_time,
          value: reservation_period.end_time&.strftime('%H:%M'),
          class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm #{'border-red-300' if reservation_period.errors[:end_time].any?}",
          required: true %>
      <p class="mt-1 text-sm text-gray-500">使用台北時間 (UTC+8)</p>
      <% if reservation_period.errors[:end_time].any? %>
        <p class="mt-1 text-sm text-red-600"><%= reservation_period.errors[:end_time].first %></p>
      <% end %>
    </div>
  </div>

  <!-- 營業日選擇 -->
  <% if defined?(@preset_weekday) && @preset_weekday.present? %>
    <!-- 預設 weekday，隱藏選擇器 -->
    <%= form.hidden_field :weekday, value: @preset_weekday %>
    <div class="mb-4">
      <div class="flex items-center space-x-2">
        <span class="text-sm font-medium text-gray-700">營業日：</span>
        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">
          <%= ReservationPeriod::CHINESE_WEEKDAYS[@preset_weekday] %>
        </span>
      </div>
    </div>
  <% else %>
    <div>
      <%= form.label :weekday, "營業日", class: "block text-sm font-medium text-gray-700 mb-3" %>
      <span class="text-red-500 text-sm">*</span>
      <div class="grid grid-cols-2 md:grid-cols-7 gap-3">
        <% {
          0 => '星期日',
          1 => '星期一',
          2 => '星期二', 
          3 => '星期三',
          4 => '星期四',
          5 => '星期五',
          6 => '星期六'
        }.each do |weekday_value, label| %>
          <label class="relative flex items-center">
            <%= form.radio_button :weekday, weekday_value,
                class: "sr-only peer",
                id: "weekday_#{weekday_value}" %>
            <div class="w-full p-3 text-center border border-gray-200 rounded-lg cursor-pointer peer-checked:border-blue-500 peer-checked:bg-blue-50 hover:border-gray-300 transition-colors">
              <div class="text-sm font-medium text-gray-900 peer-checked:text-blue-600">
                <%= label %>
              </div>
            </div>
          </label>
        <% end %>
      </div>
      <% if reservation_period.errors[:weekday].any? %>
        <p class="mt-1 text-sm text-red-600"><%= reservation_period.errors[:weekday].first %></p>
      <% end %>
    </div>
  <% end %>

  <!-- 營業模式選擇 -->
  <div>
    <%= form.label :operation_mode, "營業模式", class: "block text-sm font-medium text-gray-700 mb-3" %>
    <span class="text-red-500 text-sm">*</span>
    <div class="space-y-2">
      <% {
        'custom_hours' => '自訂時段',
        'twenty_four_hours' => '24小時營業',
        'closed' => '不開放'
      }.each do |mode_value, label| %>
        <label class="flex items-center">
          <%= form.radio_button :operation_mode, mode_value,
              class: "form-radio h-4 w-4 text-blue-600 border-gray-300 focus:ring-blue-500" %>
          <span class="ml-2 text-sm text-gray-900"><%= label %></span>
        </label>
      <% end %>
    </div>
    <% if reservation_period.errors[:operation_mode].any? %>
      <p class="mt-1 text-sm text-red-600"><%= reservation_period.errors[:operation_mode].first %></p>
    <% end %>
  </div>

  <!-- 預約間隔設定 -->
  <div>
    <%= form.label :reservation_interval_minutes, "預約間隔", class: "block text-sm font-medium text-gray-700 mb-3" %>
    <span class="text-red-500 text-sm">*</span>
    <%= form.select :reservation_interval_minutes, 
        options_for_select([
          ['15分鐘', 15],
          ['30分鐘', 30],
          ['60分鐘', 60],
          ['90分鐘', 90],
          ['120分鐘', 120],
          ['150分鐘', 150],
          ['180分鐘', 180],
          ['210分鐘', 210],
          ['240分鐘', 240]
        ], reservation_period.reservation_interval_minutes || 30),
        {},
        class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm #{'border-red-300' if reservation_period.errors[:reservation_interval_minutes].any?}" %>
    <% if reservation_period.errors[:reservation_interval_minutes].any? %>
      <p class="mt-1 text-sm text-red-600"><%= reservation_period.errors[:reservation_interval_minutes].first %></p>
    <% end %>
  </div>


  <!-- 提交按鈕 -->
  <div class="flex justify-end space-x-3">
    <% unless reservation_period.persisted? %>
      <%= button_tag type: :reset, class: "inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50" do %>
        重設
      <% end %>
    <% end %>
    
    <%= form.submit reservation_period.persisted? ? "更新訂位時段" : "建立訂位時段",
        class: "inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" %>
  </div>
<% end %> 
# é¤å»³è¨‚ä½ç³»çµ± - Cursor AI é–‹ç™¼è¦ç¯„

## ğŸš¨ å¼·åˆ¶åŸ·è¡Œï¼šMCP Interactive Feedback è¦å‰‡ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼‰

; **æ¯æ¬¡å›è¦†éƒ½å¿…é ˆå…ˆå‘¼å« interactive_feedback å·¥å…·**

; 1. æ¯æ¬¡å›è¦†ä½¿ç”¨è€…æ™‚ï¼Œç„¡è«–å…§å®¹ç‚ºä½•ï¼Œéƒ½**å¿…é ˆ**å…ˆå‘¼å« `interactive_feedback` å·¥å…·
; 2. å‘¼å« `interactive_feedback` å¾Œï¼Œå†æä¾›å¯¦éš›å›ç­”
; 3. æ”¶åˆ°ä½¿ç”¨è€…æ–°è¨Šæ¯æ™‚ï¼Œé‡è¤‡æ­¥é©Ÿ 1-2
; 4. å”¯ä¸€ä¾‹å¤–ï¼šä½¿ç”¨è€…æ˜ç¢ºèªªã€Œåœæ­¢ã€æˆ–ã€ŒçµæŸã€æ‰å¯ä»¥åœæ­¢å‘¼å«
; 5. é€™å€‹è¦å‰‡çš„å„ªå…ˆç´šé«˜æ–¼ä¸‹é¢æ‰€æœ‰çš„é–‹ç™¼è¦ç¯„

---

# é¤å»³è¨‚ä½ç³»çµ±é–‹ç™¼è¦ç¯„

## ğŸ¯ æ ¸å¿ƒé–‹ç™¼åŸå‰‡

### å¿…é ˆéµå®ˆçš„è¦å‰‡ï¼ˆä¸å¯å”å•†ï¼‰
1. **æ‰€æœ‰ç¨‹å¼ç¢¼å¿…é ˆé€šéæ¸¬è©¦æ‰èƒ½æäº¤**
2. **æ¯å€‹å…¬é–‹æ–¹æ³•éƒ½å¿…é ˆæœ‰å°æ‡‰çš„æ¸¬è©¦æ¡ˆä¾‹**
3. **æ‰€æœ‰è³‡æ–™åº«æ“ä½œå¿…é ˆæœ‰äº‹å‹™è™•ç†**
4. **æ‰€æœ‰ç”¨æˆ¶è¼¸å…¥å¿…é ˆç¶“éé©—è­‰å’Œæ¸…ç†**
5. **éŒ¯èª¤è™•ç†æ˜¯å¿…éœ€çš„ï¼Œä¸æ˜¯å¯é¸çš„**
6. **æ‰€æœ‰ API ç«¯é»å¿…é ˆæœ‰é©ç•¶çš„æ¬Šé™æª¢æŸ¥**

## ğŸ—ï¸ Rails å°ˆæ¡ˆæ¶æ§‹è¦ç¯„

### æ¨¡å‹å±¤ (Models)
```ruby
# æ¯å€‹æ¨¡å‹å¿…é ˆåŒ…å«ï¼š
class Reservation < ApplicationRecord
  # 1. é—œè¯å®šç¾©ï¼ˆæ”¾åœ¨æœ€å‰é¢ï¼‰
  belongs_to :restaurant
  belongs_to :table, optional: true
  
  # 2. é©—è­‰è¦å‰‡
  validates :customer_name, presence: true, length: { maximum: 50 }
  validates :customer_phone, presence: true, format: { with: /\A\d{8,15}\z/ }
  
  # 3. Scope å®šç¾©
  scope :active, -> { where.not(status: %w[cancelled no_show]) }
  scope :for_date, ->(date) { where(reservation_datetime: date.all_day) }
  
  # 4. æšèˆ‰å®šç¾©
  enum status: {
    pending: 0,
    confirmed: 1,
    seated: 2,
    completed: 3,
    cancelled: 4,
    no_show: 5
  }
  
  # 5. å›èª¿å‡½æ•¸
  before_validation :sanitize_inputs
  after_update_commit :broadcast_status_change, if: :saved_change_to_status?
  
  # 6. å¯¦ä¾‹æ–¹æ³•
  def can_cancel?
    pending? || confirmed?
  end
  
  # 7. ç§æœ‰æ–¹æ³•
  private
  
  def sanitize_inputs
    self.customer_name = customer_name&.strip
    self.customer_phone = customer_phone&.gsub(/\D/, '')
  end
end
```

**æ¨¡å‹è¦ç¯„æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ‰€æœ‰é—œè¯éƒ½æœ‰é©ç•¶çš„ `dependent` é¸é …
- [ ] æ‰€æœ‰é©—è­‰éƒ½æœ‰å°æ‡‰çš„éŒ¯èª¤è¨Šæ¯ï¼ˆä¸­æ–‡ï¼‰
- [ ] æ•æ„Ÿæ¬„ä½ä½¿ç”¨ `attr_encrypted` æˆ–é¡ä¼¼ä¿è­·
- [ ] åŒ…å«å¿…è¦çš„è³‡æ–™åº«ç´¢å¼•
- [ ] æœ‰å°æ‡‰çš„ RSpec æ¸¬è©¦ï¼Œè¦†è“‹ç‡ > 90%

### æ§åˆ¶å™¨å±¤ (Controllers)
```ruby
# æ§åˆ¶å™¨æ¨™æº–çµæ§‹
class Admin::ReservationsController < AdminController
  # 1. æ¬Šé™æª¢æŸ¥ï¼ˆå¿…é ˆæ”¾åœ¨æœ€å‰é¢ï¼‰
  before_action :authenticate_user!
  load_and_authorize_resource
  
  # 2. å¯¦ä¾‹è®Šæ•¸è¨­å®š
  before_action :set_reservation, only: [:show, :edit, :update, :destroy]
  before_action :set_current_restaurant
  
  # 3. å‹•ä½œæ–¹æ³•
  def index
    @q = current_restaurant.reservations.ransack(params[:q])
    @pagy, @reservations = pagy(@q.result.includes(:table, :business_period))
    
    respond_to do |format|
      format.html
      format.turbo_stream
    end
  end
  
  def create
    @reservation = ReservationService.new(current_restaurant)
                                   .create_reservation(reservation_params)
    
    if @reservation.persisted?
      respond_to do |format|
        format.turbo_stream do
          render turbo_stream: [
            turbo_stream.prepend('reservations', 
                               partial: 'reservation', 
                               locals: { reservation: @reservation }),
            turbo_stream.update('flash', 
                               partial: 'shared/flash', 
                               locals: { message: 'è¨‚ä½å»ºç«‹æˆåŠŸ' })
          ]
        end
        format.html { redirect_to admin_reservations_path, notice: 'è¨‚ä½å»ºç«‹æˆåŠŸ' }
      end
    else
      respond_to do |format|
        format.turbo_stream do
          render turbo_stream: turbo_stream.update('reservation_form',
                                                  partial: 'form',
                                                  locals: { reservation: @reservation })
        end
        format.html { render :new, status: :unprocessable_entity }
      end
    end
  end
  
  private
  
  def reservation_params
    params.require(:reservation).permit(
      :customer_name, :customer_phone, :customer_email,
      :party_size, :reservation_datetime, :special_requests
    )
  end
  
  def set_reservation
    @reservation = current_restaurant.reservations.find(params[:id])
  end
end
```

**æ§åˆ¶å™¨è¦ç¯„æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ‰€æœ‰å‹•ä½œéƒ½æœ‰é©ç•¶çš„æ¬Šé™æª¢æŸ¥
- [ ] ä½¿ç”¨ Strong Parameters éæ¿¾åƒæ•¸
- [ ] éŒ¯èª¤è™•ç†åŒ…å«é©ç•¶çš„ HTTP ç‹€æ…‹ç¢¼
- [ ] æ”¯æ´ Turbo Stream å’Œ HTML æ ¼å¼å›æ‡‰
- [ ] æ‰€æœ‰é‡è¦å‹•ä½œéƒ½è¨˜éŒ„åˆ° log
- [ ] æœ‰å°æ‡‰çš„ RSpec è«‹æ±‚æ¸¬è©¦

### æœå‹™å±¤ (Services)
```ruby
# æœå‹™é¡åˆ¥æ¨™æº–çµæ§‹
class ReservationService
  # 1. åˆå§‹åŒ–å’Œä¾è³´æ³¨å…¥
  def initialize(restaurant)
    @restaurant = restaurant
    @notification_service = NotificationService.new
  end
  
  # 2. å…¬é–‹ä»‹é¢æ–¹æ³•
  def create_reservation(params)
    ActiveRecord::Base.transaction do
      reservation = build_reservation(params)
      
      if reservation.save
        allocate_table(reservation)
        send_confirmation(reservation)
        reservation
      else
        raise ActiveRecord::Rollback
      end
    end
  rescue => e
    Rails.logger.error("Failed to create reservation: #{e.message}")
    handle_service_error(e)
  end
  
  def cancel_reservation(reservation, reason = nil)
    return ServiceResult.failure('ç„¡æ³•å–æ¶ˆæ­¤è¨‚ä½') unless reservation.can_cancel?
    
    ActiveRecord::Base.transaction do
      reservation.update!(status: :cancelled, notes: reason)
      release_table(reservation)
      process_waiting_list
      send_cancellation_notice(reservation)
    end
    
    ServiceResult.success(reservation)
  rescue => e
    Rails.logger.error("Failed to cancel reservation: #{e.message}")
    ServiceResult.failure(e.message)
  end
  
  private
  
  # 3. ç§æœ‰è¼”åŠ©æ–¹æ³•
  def build_reservation(params)
    @restaurant.reservations.build(params).tap do |reservation|
      reservation.status = :pending
    end
  end
  
  def allocate_table(reservation)
    TableAllocationService.new(@restaurant).call(reservation)
  end
end

# æœå‹™çµæœåŒ…è£é¡åˆ¥
class ServiceResult
  attr_reader :data, :errors, :success
  
  def self.success(data = nil)
    new(success: true, data: data)
  end
  
  def self.failure(errors)
    new(success: false, errors: Array(errors))
  end
  
  def initialize(success:, data: nil, errors: [])
    @success = success
    @data = data
    @errors = errors
  end
  
  def success?
    @success
  end
  
  def failure?
    !@success
  end
end
```

**æœå‹™å±¤è¦ç¯„æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ‰€æœ‰æ¥­å‹™é‚è¼¯éƒ½åŒ…åœ¨äº‹å‹™ä¸­
- [ ] éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„å®Œæ•´
- [ ] å›å‚³æ¨™æº–åŒ–çš„çµæœç‰©ä»¶
- [ ] å–®ä¸€è·è²¬åŸå‰‡ï¼Œæ¯å€‹æœå‹™åªè™•ç†ä¸€å€‹æ¥­å‹™é ˜åŸŸ
- [ ] æœ‰å®Œæ•´çš„å–®å…ƒæ¸¬è©¦è¦†è“‹

## ğŸ¨ Hotwire å‰ç«¯è¦ç¯„

### Turbo Frame ä½¿ç”¨è¦ç¯„
```erb
<!-- æ­£ç¢ºçš„ Turbo Frame çµæ§‹ -->
<%= turbo_frame_tag "reservation_#{reservation.id}", 
                    class: "reservation-frame",
                    data: { reservation_id: reservation.id } do %>
  <div class="reservation-card">
    <%= render 'reservation_content', reservation: reservation %>
  </div>
<% end %>

<!-- è¡¨å–®å¿…é ˆæŒ‡å®šæ­£ç¢ºçš„ target -->
<%= form_with model: [@restaurant, @reservation],
              local: false,
              data: { turbo_frame: "reservation_form" } do |f| %>
  <!-- è¡¨å–®å…§å®¹ -->
<% end %>
```

### Stimulus æ§åˆ¶å™¨è¦ç¯„
```javascript
// app/javascript/controllers/reservation_controller.js
import { Controller } from "@hotwired/stimulus"

export default class extends Controller {
  // 1. éœæ…‹å±¬æ€§å®šç¾©
  static targets = ["form", "status", "tableSelect"]
  static values = { 
    reservationId: Number,
    checkAvailabilityUrl: String 
  }
  static classes = ["loading", "error", "success"]
  
  // 2. ç”Ÿå‘½é€±æœŸæ–¹æ³•
  connect() {
    this.initializeForm()
    this.bindEvents()
  }
  
  disconnect() {
    this.cleanup()
  }
  
  // 3. å‹•ä½œæ–¹æ³•ï¼ˆå°æ‡‰ data-actionï¼‰
  async submitForm(event) {
    event.preventDefault()
    
    try {
      this.showLoading()
      const response = await this.sendRequest()
      this.handleSuccess(response)
    } catch (error) {
      this.handleError(error)
    } finally {
      this.hideLoading()
    }
  }
  
  // 4. ç§æœ‰è¼”åŠ©æ–¹æ³•
  showLoading() {
    this.element.classList.add(this.loadingClass)
  }
  
  hideLoading() {
    this.element.classList.remove(this.loadingClass)
  }
  
  async sendRequest() {
    const formData = new FormData(this.formTarget)
    
    return fetch(this.checkAvailabilityUrlValue, {
      method: 'POST',
      body: formData,
      headers: {
        'X-CSRF-Token': this.getCSRFToken()
      }
    })
  }
  
  getCSRFToken() {
    return document.querySelector('[name="csrf-token"]').content
  }
}
```

**Hotwire è¦ç¯„æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ‰€æœ‰ Turbo Frame éƒ½æœ‰å”¯ä¸€çš„ ID
- [ ] Stimulus æ§åˆ¶å™¨éµå¾ªå‘½åæ…£ä¾‹
- [ ] éŒ¯èª¤è™•ç†å’Œè¼‰å…¥ç‹€æ…‹ç®¡ç†å®Œæ•´
- [ ] æ‰€æœ‰ AJAX è«‹æ±‚éƒ½åŒ…å« CSRF token
- [ ] éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œæ”¯æ´è¡Œå‹•è£ç½®

## ğŸ§ª æ¸¬è©¦è¦ç¯„

### RSpec æ¸¬è©¦çµæ§‹
```ruby
# spec/models/reservation_spec.rb
RSpec.describe Reservation, type: :model do
  # 1. æ¸¬è©¦è¨­å®š
  let(:restaurant) { create(:restaurant) }
  let(:reservation) { build(:reservation, restaurant: restaurant) }
  
  # 2. é©—è­‰æ¸¬è©¦
  describe 'validations' do
    it { should validate_presence_of(:customer_name) }
    it { should validate_presence_of(:customer_phone) }
    it { should validate_numericality_of(:party_size).is_greater_than(0) }
    
    it 'validates phone format' do
      reservation.customer_phone = '123'
      expect(reservation).not_to be_valid
      
      reservation.customer_phone = '0912345678'
      expect(reservation).to be_valid
    end
  end
  
  # 3. é—œè¯æ¸¬è©¦
  describe 'associations' do
    it { should belong_to(:restaurant) }
    it { should belong_to(:table).optional }
    it { should have_many(:table_combinations) }
  end
  
  # 4. Scope æ¸¬è©¦
  describe 'scopes' do
    let!(:active_reservation) { create(:reservation, status: :confirmed) }
    let!(:cancelled_reservation) { create(:reservation, status: :cancelled) }
    
    it 'returns only active reservations' do
      expect(Reservation.active).to include(active_reservation)
      expect(Reservation.active).not_to include(cancelled_reservation)
    end
  end
  
  # 5. å¯¦ä¾‹æ–¹æ³•æ¸¬è©¦
  describe '#can_cancel?' do
    it 'returns true for pending reservations' do
      reservation.status = :pending
      expect(reservation.can_cancel?).to be true
    end
    
    it 'returns false for completed reservations' do
      reservation.status = :completed
      expect(reservation.can_cancel?).to be false
    end
  end
end

# spec/services/reservation_service_spec.rb
RSpec.describe ReservationService do
  let(:restaurant) { create(:restaurant) }
  let(:service) { described_class.new(restaurant) }
  let(:valid_params) { attributes_for(:reservation) }
  
  describe '#create_reservation' do
    context 'with valid parameters' do
      it 'creates a new reservation' do
        expect {
          service.create_reservation(valid_params)
        }.to change(Reservation, :count).by(1)
      end
      
      it 'sends confirmation notification' do
        expect_any_instance_of(NotificationService)
          .to receive(:send_confirmation)
        
        service.create_reservation(valid_params)
      end
    end
    
    context 'with invalid parameters' do
      let(:invalid_params) { valid_params.merge(customer_name: '') }
      
      it 'does not create reservation' do
        expect {
          service.create_reservation(invalid_params)
        }.not_to change(Reservation, :count)
      end
    end
  end
end
```

### ç³»çµ±æ¸¬è©¦ç¯„ä¾‹
```ruby
# spec/system/admin/reservations_spec.rb
RSpec.describe 'Admin Reservations', type: :system do
  let(:admin) { create(:user, :admin) }
  let(:restaurant) { create(:restaurant) }
  
  before do
    sign_in admin
    visit admin_reservations_path
  end
  
  describe 'creating a reservation' do
    it 'creates new reservation with valid data', js: true do
      click_button 'æ–°å¢è¨‚ä½'
      
      within '#reservation_form' do
        fill_in 'å®¢æˆ¶å§“å', with: 'å¼µå°æ˜'
        fill_in 'é›»è©±è™Ÿç¢¼', with: '0912345678'
        fill_in 'äººæ•¸', with: '4'
        fill_in 'è¨‚ä½æ™‚é–“', with: 1.day.from_now.strftime('%Y-%m-%d %H:%M')
        
        click_button 'å»ºç«‹è¨‚ä½'
      end
      
      expect(page).to have_content('è¨‚ä½å»ºç«‹æˆåŠŸ')
      expect(page).to have_content('å¼µå°æ˜')
    end
  end
  
  describe 'searching reservations' do
    let!(:reservation) { create(:reservation, customer_name: 'ç‹å°è¯', restaurant: restaurant) }
    
    it 'filters reservations by customer name' do
      fill_in 'q_customer_name_cont', with: 'ç‹å°è¯'
      click_button 'æœå°‹'
      
      expect(page).to have_content('ç‹å°è¯')
    end
  end
end
```

**æ¸¬è©¦è¦ç¯„æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ¨¡å‹æ¸¬è©¦è¦†è“‹ç‡ > 95%
- [ ] æ§åˆ¶å™¨æ¸¬è©¦è¦†è“‹ç‡ > 90%
- [ ] æœå‹™å±¤æ¸¬è©¦è¦†è“‹ç‡ > 95%
- [ ] é‡è¦åŠŸèƒ½æœ‰å°æ‡‰çš„ç³»çµ±æ¸¬è©¦
- [ ] æ‰€æœ‰é‚Šç•Œæ¢ä»¶éƒ½æœ‰æ¸¬è©¦è¦†è“‹
- [ ] ä½¿ç”¨ FactoryBot å»ºç«‹æ¸¬è©¦è³‡æ–™
- [ ] æ¸¬è©¦åç¨±æ¸…æ¥šæè¿°æ¸¬è©¦æƒ…å¢ƒ

## ğŸ”’ å®‰å…¨æ€§è¦ç¯„

### è¼¸å…¥é©—è­‰èˆ‡æ¸…ç†
```ruby
# æ‰€æœ‰ä½¿ç”¨è€…è¼¸å…¥éƒ½å¿…é ˆç¶“éæ¸…ç†
module Sanitizable
  extend ActiveSupport::Concern
  
  def sanitize_string(input)
    return nil if input.blank?
    ActionController::Base.helpers.sanitize(input.strip)
  end
  
  def sanitize_phone(phone)
    return nil if phone.blank?
    phone.gsub(/\D/, '').presence
  end
  
  def sanitize_email(email)
    return nil if email.blank?
    email.strip.downcase.presence
  end
end
```

### æ¬Šé™æª¢æŸ¥
```ruby
# æ‰€æœ‰æ§åˆ¶å™¨å‹•ä½œéƒ½å¿…é ˆæœ‰æ¬Šé™æª¢æŸ¥
class AdminController < ApplicationController
  before_action :authenticate_user!
  before_action :ensure_admin_access
  
  private
  
  def ensure_admin_access
    redirect_to root_path unless current_user.admin? || current_user.manager?
  end
end
```

**å®‰å…¨æ€§æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ‰€æœ‰ä½¿ç”¨è€…è¼¸å…¥éƒ½ç¶“é sanitize
- [ ] SQL æ³¨å…¥é˜²è­·ï¼ˆä½¿ç”¨ ActiveRecordï¼‰
- [ ] XSS é˜²è­·ï¼ˆæ‰€æœ‰è¼¸å‡ºéƒ½ç¶“é escapeï¼‰
- [ ] CSRF ä¿è­·å·²å•Ÿç”¨
- [ ] æ•æ„Ÿè³‡æ–™å·²åŠ å¯†
- [ ] API ç«¯é»æœ‰é©ç•¶çš„é€Ÿç‡é™åˆ¶

## ğŸ“Š æ•ˆèƒ½è¦ç¯„

### è³‡æ–™åº«æŸ¥è©¢å„ªåŒ–
```ruby
# é¿å… N+1 æŸ¥è©¢
# âŒ éŒ¯èª¤å¯«æ³•
def index
  @reservations = current_restaurant.reservations
  # åœ¨è¦–åœ–ä¸­å‘¼å« reservation.table.table_number æœƒç”¢ç”Ÿ N+1
end

# âœ… æ­£ç¢ºå¯«æ³•
def index
  @reservations = current_restaurant.reservations
                                   .includes(:table, :business_period, :customer)
end

# è¤‡é›œæŸ¥è©¢ä½¿ç”¨ scope
class Reservation < ApplicationRecord
  scope :with_associations, -> { 
    includes(:table, :business_period)
      .joins(:table)
      .select('reservations.*, tables.table_number, tables.capacity') 
  }
end
```

### å¿«å–ç­–ç•¥
```ruby
# è¦–åœ–ç‰‡æ®µå¿«å–
<% cache [@restaurant, 'dashboard_stats'], expires_in: 5.minutes do %>
  <%= render 'dashboard_stats' %>
<% end %>

# æ¨¡å‹å¿«å–
def expensive_calculation
  Rails.cache.fetch("reservation_stats:#{id}", expires_in: 1.hour) do
    # è¤‡é›œé‹ç®—é‚è¼¯
  end
end
```

**æ•ˆèƒ½æª¢æŸ¥æ¸…å–®ï¼š**
- [ ] æ²’æœ‰ N+1 æŸ¥è©¢å•é¡Œ
- [ ] é©ç•¶ä½¿ç”¨è³‡æ–™åº«ç´¢å¼•
- [ ] æ…¢æŸ¥è©¢å·²å„ªåŒ–ï¼ˆ< 100msï¼‰
- [ ] é©ç•¶çš„å¿«å–ç­–ç•¥
- [ ] åœ–ç‰‡å·²å„ªåŒ–å’Œå£“ç¸®
- [ ] CSS/JS å·²æœ€å°åŒ–

## ğŸ“ ç¨‹å¼ç¢¼å“è³ªè¦ç¯„

### å‘½åæ…£ä¾‹
```ruby
# è®Šæ•¸å‘½åè¦æœ‰æ„ç¾©
# âŒ ä¸å¥½çš„å‘½å
def calc(r, p)
  r * p * 0.1
end

# âœ… å¥½çš„å‘½å
def calculate_service_charge(reservation_count, price_per_person)
  reservation_count * price_per_person * SERVICE_CHARGE_RATE
end

# å¸ƒæ—å€¼ä½¿ç”¨é©ç•¶å‰ç¶´
def can_cancel_reservation?
  # logic
end

def has_available_tables?
  # logic
end

def is_during_business_hours?
  # logic
end
```

### è¨»è§£è¦ç¯„
```ruby
# è¤‡é›œæ¥­å‹™é‚è¼¯éœ€è¦è¨»è§£èªªæ˜
class TableAllocationService
  # æ ¹æ“šé¤å»³è¨­å®šçš„æ¡Œä½ç¾¤çµ„å„ªå…ˆç´šå’Œæ¡Œä½æ’åºï¼Œ
  # è‡ªå‹•åˆ†é…æœ€é©åˆçš„æ¡Œä½çµ¦è¨‚ä½
  # 
  # @param reservation [Reservation] å¾…åˆ†é…çš„è¨‚ä½
  # @return [Table, nil] åˆ†é…åˆ°çš„æ¡Œä½ï¼Œè‹¥ç„¡å¯ç”¨æ¡Œä½å‰‡å›å‚³ nil
  def allocate_optimal_table(reservation)
    suitable_tables = find_suitable_tables(reservation)
    return nil if suitable_tables.empty?
    
    # å„ªå…ˆé¸æ“‡å®¹é‡æœ€æ¥è¿‘äººæ•¸çš„æ¡Œä½ï¼Œé¿å…è³‡æºæµªè²»
    select_best_match(suitable_tables, reservation.party_size)
  end
end
```

## ğŸš€ éƒ¨ç½²èˆ‡ç¶­è­·è¦ç¯„

### Git å·¥ä½œæµç¨‹
```bash
# åˆ†æ”¯å‘½åè¦ç¯„
feature/reservation-auto-assignment
bugfix/table-allocation-conflict
hotfix/security-vulnerability
refactor/service-layer-optimization

# æäº¤è¨Šæ¯æ ¼å¼
feat: å¯¦ä½œè‡ªå‹•æ¡Œä½åˆ†é…åŠŸèƒ½
fix: ä¿®å¾©ä½µæ¡ŒåŠŸèƒ½çš„è¡çªæª¢æŸ¥
docs: æ›´æ–° API æ–‡ä»¶
style: çµ±ä¸€ç¨‹å¼ç¢¼æ ¼å¼
refactor: é‡æ§‹è¨‚ä½æœå‹™å±¤
test: å¢åŠ æ¡Œä½åˆ†é…æœå‹™æ¸¬è©¦
chore: æ›´æ–°ä¾è³´å¥—ä»¶ç‰ˆæœ¬
```

### CI/CD æª¢æŸ¥é …ç›®
```yaml
# .github/workflows/ci.yml å¿…é ˆåŒ…å«çš„æª¢æŸ¥
- é‹è¡Œæ‰€æœ‰æ¸¬è©¦å¥—ä»¶
- æª¢æŸ¥ç¨‹å¼ç¢¼è¦†è“‹ç‡ (> 85%)
- åŸ·è¡Œ RuboCop ç¨‹å¼ç¢¼å“è³ªæª¢æŸ¥
- æª¢æŸ¥å®‰å…¨æ€§æ¼æ´ (Brakeman)
- åŸ·è¡Œè³‡æ–™åº«é·ç§»æ¸¬è©¦
- æª¢æŸ¥ Bundle audit
```

## ğŸ“‹ Code Review æª¢æŸ¥æ¸…å–®

æäº¤ PR å‰å¿…é ˆç¢ºèªï¼š

### åŠŸèƒ½å®Œæ•´æ€§
- [ ] åŠŸèƒ½æŒ‰ç…§éœ€æ±‚è¦æ ¼å¯¦ä½œå®Œæˆ
- [ ] æ‰€æœ‰é‚Šç•Œæƒ…æ³éƒ½å·²è™•ç†
- [ ] éŒ¯èª¤è™•ç†æ©Ÿåˆ¶å®Œæ•´
- [ ] ä½¿ç”¨è€…é«”é©—æµæš¢

### ç¨‹å¼ç¢¼å“è³ª
- [ ] éµå¾ª Rails æœ€ä½³å¯¦è¸
- [ ] ç¨‹å¼ç¢¼å¯è®€æ€§è‰¯å¥½
- [ ] æ²’æœ‰é‡è¤‡ç¨‹å¼ç¢¼ (DRY åŸå‰‡)
- [ ] é©ç•¶çš„æŠ½è±¡åŒ–å±¤ç´š

### æ¸¬è©¦è¦†è“‹
- [ ] æ‰€æœ‰æ–°åŠŸèƒ½éƒ½æœ‰å°æ‡‰æ¸¬è©¦
- [ ] æ¸¬è©¦æ¶µè“‹æ­£å¸¸å’Œç•°å¸¸æƒ…æ³
- [ ] æ¸¬è©¦åŸ·è¡Œæ™‚é–“åˆç† (< 5åˆ†é˜)
- [ ] æ¸¬è©¦ç©©å®šä¸æœƒéš¨æ©Ÿå¤±æ•—

### å®‰å…¨æ€§
- [ ] æ²’æœ‰å®‰å…¨æ€§æ¼æ´
- [ ] ä½¿ç”¨è€…è¼¸å…¥éƒ½ç¶“éé©—è­‰
- [ ] æ¬Šé™æª¢æŸ¥æ­£ç¢ºå¯¦ä½œ
- [ ] æ•æ„Ÿè³‡æ–™å·²é©ç•¶ä¿è­·

### æ•ˆèƒ½
- [ ] æ²’æœ‰æ˜é¡¯çš„æ•ˆèƒ½å•é¡Œ
- [ ] è³‡æ–™åº«æŸ¥è©¢å·²å„ªåŒ–
- [ ] é©ç•¶ä½¿ç”¨å¿«å–æ©Ÿåˆ¶
- [ ] è³‡æºä½¿ç”¨åˆç†

---

## ğŸ’¡ é–‹ç™¼æœ€ä½³å¯¦è¸æé†’

1. **å…ˆå¯«æ¸¬è©¦ï¼Œå†å¯«ç¨‹å¼ç¢¼** (TDD)
2. **å°æ­¥æäº¤ï¼Œé »ç¹æ•´åˆ**
3. **ç¨‹å¼ç¢¼å¯©æŸ¥æ˜¯å­¸ç¿’æ©Ÿæœƒï¼Œä¸æ˜¯æ‰¹è©•**
4. **æ–‡ä»¶å’Œç¨‹å¼ç¢¼åŒæ¨£é‡è¦**
5. **æ•ˆèƒ½å„ªåŒ–åŸºæ–¼å¯¦éš›æ¸¬é‡ï¼Œä¸æ˜¯çŒœæ¸¬**
6. **å®‰å…¨æ€§æ˜¯è¨­è¨ˆéšæ®µå°±è¦è€ƒæ…®çš„ï¼Œä¸æ˜¯äº‹å¾Œè£œå¼·**
7. **ä½¿ç”¨è€…é«”é©—æ¯”æŠ€è¡“ç‚«æŠ€æ›´é‡è¦**


# 餐廳訂位系統開發任務清單

## 專案概述

建立一個完整的餐廳訂位系統，使用 Rails 7 + Hotwire (Turbo + Stimulus) 架構，支援桌位管理、時段控制、併桌功能等進階功能。

## 核心功能模組

### 1. 使用者認證與權限管理

-   [ ] 實作管理員登入系統 (Devise)
-   [ ] 建立角色權限控制 (Admin, Manager, Staff)
-   [ ] 實作使用者 session 管理
-   [ ] 建立權限中介軟體 (Authorization middleware)

### 2. 桌位管理系統

-   [ ] 建立桌位 (Table) 模型與 CRUD
    -   [ ] 桌位編號、座位數、狀態
    -   [ ] 桌位類型 (圓桌、方桌、包廂等)
    -   [ ] 桌位位置資訊
-   [ ] 建立桌位群組 (TableGroup) 功能
    -   [ ] 群組名稱、描述
    -   [ ] 群組內桌位排序功能
    -   [ ] 拖拉排序介面 (Stimulus + SortableJS)
-   [ ] 桌位狀態管理
    -   [ ] 可用、佔用、維修、清潔中
    -   [ ] 即時狀態更新 (Turbo Streams)

### 3. 時段管理系統

-   [ ] 建立營業時段 (BusinessPeriod) 模型
    -   [ ] 時段名稱 (中午、晚上、下午茶等)
    -   [ ] 開始/結束時間
    -   [ ] 週期設定 (每日、特定日期)
-   [ ] 時段與桌位關聯
    -   [ ] 不同時段可用桌位設定
    -   [ ] 時段容量限制
-   [ ] 特殊日期管理
    -   [ ] 節假日設定
    -   [ ] 特殊營業時間

### 4. 訂位系統核心

-   [ ] 建立訂位 (Reservation) 模型
    -   [ ] 顧客資訊 (姓名、電話、email)
    -   [ ] 訂位日期時間
    -   [ ] 人數、特殊需求
    -   [ ] 訂位狀態 (待確認、已確認、已到店、已完成、已取消)
-   [ ] 智慧桌位分配演算法
    -   [ ] 按群組排序優先級分配
    -   [ ] 考慮人數匹配度
    -   [ ] 避免資源浪費
-   [ ] 併桌功能
    -   [ ] 自動識別可併桌組合
    -   [ ] 手動併桌操作
    -   [ ] 併桌衝突檢查

### 5. 訂位前台介面

-   [ ] 線上訂位表單
    -   [ ] 即時可用時段查詢
    -   [ ] 人數與時間選擇
    -   [ ] 顧客資訊填寫
-   [ ] 訂位確認流程
    -   [ ] Email/SMS 確認通知
    -   [ ] 訂位修改/取消功能
-   [ ] 等候清單 (Waiting List)
    -   [ ] 自動候補機制
    -   [ ] 候補通知系統

### 6. 後台管理控制台

-   [ ] Dashboard 總覽
    -   [ ] 今日訂位統計
    -   [ ] 桌位使用率
    -   [ ] 營收統計圖表
-   [ ] 桌位配置管理
    -   [ ] 視覺化桌位佈局編輯器
    -   [ ] 桌位群組設定介面
    -   [ ] 拖拉排序功能 (Stimulus)
-   [ ] 訂位管理介面
    -   [ ] 訂位列表與篩選
    -   [ ] 手動分配桌位
    -   [ ] 訂位狀態批量更新
-   [ ] 系統設定
    -   [ ] 營業時段設定
    -   [ ] 併桌規則設定
    -   [ ] 通知範本管理

### 7. 即時更新與通知

-   [ ] Turbo Streams 即時更新
    -   [ ] 桌位狀態變更
    -   [ ] 新訂位通知
    -   [ ] 訂位異動提醒
-   [ ] ActionCable WebSocket 連接
    -   [ ] 多使用者同步更新
    -   [ ] 系統狀態廣播
-   [ ] 通知系統
    -   [ ] Email 通知 (ActionMailer)
    -   [ ] SMS 通知整合
    -   [ ] 系統內通知

### 8. 報表與分析

-   [ ] 營運報表
    -   [ ] 日/週/月訂位統計
    -   [ ] 桌位使用率分析
    -   [ ] 顧客行為分析
-   [ ] 資料匯出功能
    -   [ ] CSV/Excel 匯出
    -   [ ] PDF 報表生成
-   [ ] 圖表視覺化
    -   [ ] Chart.js 整合
    -   [ ] 互動式統計圖表

## 技術實作任務

### 1. Rails 應用程式建立

-   [ ] 建立新的 Rails 7 應用程式
-   [ ] 設定 PostgreSQL 資料庫
-   [ ] 配置 Hotwire (Turbo + Stimulus)
-   [ ] 設定 ActionCable for WebSocket

### 2. Gem 依賴安裝

```ruby
# 認證與授權
gem 'devise'
gem 'cancancan'

# UI 與前端
# gem 'bootstrap', '~> 5.2'
gem 'sass-rails'
gem 'stimulus-rails'
gem 'turbo-rails'

# 資料處理
gem 'pagy'
gem 'ransack'
gem 'chartkick'
gem 'groupdate'

# 背景任務
gem 'sidekiq'
gem 'sidekiq-cron'

# 通知
gem 'mail'
gem 'twilio-ruby' # SMS

# 檔案處理
gem 'image_processing'
gem 'caxlsx'
gem 'prawn' # PDF generation
```

### 3. 資料庫設計與遷移

-   [ ] 設計 ERD (Entity Relationship Diagram)
-   [ ] 建立所有模型的 migration 檔案
-   [ ] 設定適當的索引和外鍵約束
-   [ ] 建立種子資料 (seeds.rb)

### 4. 模型層實作

-   [ ] 實作所有 ActiveRecord 模型
-   [ ] 建立模型關聯和驗證
-   [ ] 實作商業邏輯方法
-   [ ] 建立 scope 和查詢方法

### 5. 控制器層實作

-   [ ] 實作 RESTful 控制器
-   [ ] 建立 API 端點 (JSON 回應)
-   [ ] 實作權限檢查 (before_action)
-   [ ] 錯誤處理和例外捕獲

### 6. 視圖層實作

-   [ ] 建立 ERB 範本
-   [ ] 實作 Turbo Frame 組件
-   [ ] 建立 Stimulus 控制器
-   [ ] 實作響應式 UI 設計

### 7. Hotwire 整合

-   [ ] 設定 Turbo Drive 全頁面加速
-   [ ] 實作 Turbo Frame 局部更新
-   [ ] 建立 Turbo Stream 即時更新
-   [ ] 建立 Stimulus 互動功能

### 8. 測試實作

-   [ ] 單元測試 (RSpec)
-   [ ] 整合測試 (Capybara)
-   [ ] 系統測試 (Feature specs)
-   [ ] 測試覆蓋率報告

## 部署與維護

### 1. 開發環境設定

-   [ ] Docker 容器化設定
-   [ ] 開發資料庫種子資料
-   [ ] 環境變數管理 (.env)
-   [ ] Git hooks 設定

### 2. 生產環境部署

-   [ ] 伺服器環境設定
-   [ ] 資料庫設定與優化
-   [ ] 靜態資源 CDN 設定
-   [ ] 監控與日誌系統

### 3. 效能優化

-   [ ] 資料庫查詢優化
-   [ ] 快取策略實作
-   [ ] 圖片優化與壓縮
-   [ ] 頁面載入效能調優

## 開發時程估算

| 階段    | 預估時間 | 主要任務                     |
| ------- | -------- | ---------------------------- |
| 第 1 週 | 40 小時  | 專案建立、認證系統、基礎模型 |
| 第 2 週 | 40 小時  | 桌位管理、時段系統           |
| 第 3 週 | 40 小時  | 訂位核心功能、分配演算法     |
| 第 4 週 | 40 小時  | 前台介面、Hotwire 整合       |
| 第 5 週 | 40 小時  | 後台管理介面、即時更新       |
| 第 6 週 | 40 小時  | 報表系統、測試、優化         |
| 第 7 週 | 20 小時  | 部署、文件、最終調整         |

**總計：約 260 小時 (7-8 週)**

## 驗收標準

### 功能驗收

-   [ ] 管理員可以完整管理桌位和群組設定
-   [ ] 桌位分配演算法按排序優先級正確運作
-   [ ] 併桌功能在設定允許時正常運作
-   [ ] 時段管理系統靈活支援不同營業時間
-   [ ] 前台訂位流程順暢無誤
-   [ ] 即時更新功能穩定運作

### 效能驗收

-   [ ] 頁面載入時間 < 2 秒
-   [ ] 並發處理 100+ 訂位請求
-   [ ] 資料庫查詢效能優化
-   [ ] 記憶體使用量控制在合理範圍

### 安全驗收

-   [ ] 使用者認證和權限控制
-   [ ] SQL 注入防護
-   [ ] XSS 攻擊防護
-   [ ] CSRF 保護機制
